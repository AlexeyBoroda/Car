{% extends 'core/base.html' %}
{% load static %}
{% block content %}
<div class="container" style="max-width:900px; margin:0 auto; padding:32px 0;">
    <h1 style="font-size:2em; font-weight:700; margin-bottom:8px;">Отзывы клиентов</h1>
    <div style="font-size:1.2em; color:#2563eb; margin-bottom:18px;">Что говорят предприниматели и руководители о работе со мной</div>
    
    <!-- Фильтры -->
    <div style="background:#f4f8fd; border-radius:12px; padding:20px; margin-bottom:32px;">
        <form method="get" style="display:flex; gap:16px; flex-wrap:wrap; align-items:center;">
            <div style="flex:1; min-width:200px;">
                <label style="display:block; margin-bottom:8px; color:#183153; font-weight:600;">Тема отзыва:</label>
                <select name="type" style="width:100%; padding:8px; border-radius:6px; border:1px solid #ccc;">
                    <option value="all" {% if current_type == 'all' or not current_type %}selected{% endif %}>Все отзывы</option>
                    {% for type_code, type_name in review_types %}
                    <option value="{{ type_code }}" {% if current_type == type_code %}selected{% endif %}>{{ type_name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div style="flex:1; min-width:200px;">
                <label style="display:block; margin-bottom:8px; color:#183153; font-weight:600;">Сортировка по дате:</label>
                <select name="date" style="width:100%; padding:8px; border-radius:6px; border:1px solid #ccc;">
                    <option value="newest" {% if current_date_sort == 'newest' %}selected{% endif %}>Сначала новые</option>
                    <option value="oldest" {% if current_date_sort == 'oldest' %}selected{% endif %}>Сначала старые</option>
                </select>
            </div>
            <div style="align-self:flex-end;">
                <!-- Кнопка удалена, автосабмит через JS -->
            </div>
        </form>
    </div>

    <!-- Список отзывов -->
    <div class="reviews-list" style="display:grid; gap:24px;">
        {% for review in reviews %}
        <div id="review-{{ review.id }}" class="review-card" style="background:#fff; border-radius:12px; padding:24px; box-shadow:0 1px 6px rgba(0,0,0,0.04);">
            <div style="display:flex; gap:16px; margin-bottom:16px;">
                {% if review.image %}
                <img src="{{ review.image.url }}" alt="{{ review.author }}" style="width:64px; height:64px; object-fit:cover; border-radius:50%;">
                {% endif %}
                <div>
                    <div style="font-weight:600; font-size:1.1em; color:#183153; margin-bottom:4px;">{{ review.author }}</div>
                    <div style="color:#666; font-size:0.9em;">{{ review.created_at|date:"d.m.Y" }}</div>
                </div>
            </div>
            <div style="color:#222; font-size:1.05em; line-height:1.5;">«{{ review.text }}»</div>
            {% if review.review_type != 'common' %}
            <div style="margin-top:12px; color:#2563eb; font-size:0.9em;">
                {% for type_code, type_name in review_types %}
                    {% if type_code == review.review_type %}
                        {{ type_name }}
                    {% endif %}
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% empty %}
        <div style="text-align:center; padding:32px; color:#666;">
            Отзывы не найдены
        </div>
        {% endfor %}
    </div>
</div>

<style>
@media (max-width: 768px) {
    .reviews-list { gap:16px; }
    .review-card { padding:16px; }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const selects = form.querySelectorAll('select');
    selects.forEach(function(select) {
        select.addEventListener('change', function() {
            // Собираем параметры
            const params = new URLSearchParams();
            selects.forEach(function(s) {
                if (s.value && s.value !== 'all' && s.name === 'type') {
                    params.append(s.name, s.value);
                } else if (s.name === 'type' && (s.value === 'all' || !s.value)) {
                    // не добавляем параметр type
                } else {
                    params.append(s.name, s.value);
                }
            });
            let url = window.location.pathname;
            if (params.toString()) {
                url += '?' + params.toString();
            }
            window.location.href = url;
        });
    });
});
</script>
{% endblock %} 